---
import Layout from "../layouts/Layout.astro";
import streams from "../data/streams.json";
---

<Layout
  title="ZEN MODE, an easy way to layout embedded content and share it with friends"
>
  <main class="content">
    <div class="custom-columns">
      {
        streams.map((stream) => {
          return (
            <div class="custom-column">
              <div class="youtube-wrapper">
                <iframe
                  class="youtube"
                  width="375"
                  height="300"
                  style="max-width:100%"
                  src={`https://www.youtube.com/embed/${stream.url}?autoplay=1&mute=1`}
                  title="YouTube video player"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                  allowfullscreen
                />
              </div>
            </div>
          );
        })
      }
    </div>

    <!--Ask the user how many columns they'd like -->
    <form>
      <label for="cols">How Many Columns:</label>
      <select name="cols" id="columnSelectBox">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
      </select>
      <br /><br />
      <input type="submit" value="Submit" />
    </form>
  </main>
</Layout>

<style>
  body {
    margin: 0;
  }
  .custom-columns {
    display: flex;
    flex-wrap: wrap;
  }
  .custom-column {
    --element-width: 25%;
    width: var(--element-width, 100%);
    box-sizing: border-box;
  }
  @media (max-width: 768px) {
    .custom-column {
      width: 100%;
    }
  }
  main {
  }
  h1 {
    font-size: 3rem !important;
    font-weight: 800 !important;
    margin: 0;
  }
  .youtube-wrapper {
    position: relative;
    overflow: hidden;
    width: 100%;
    padding-top: 56.25%;
  }
  .youtube-wrapper iframe {
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    width: 100%;
    height: 100%;
  }
</style>

<script>
  //Set width prop as URL param '?cols=2'
  const urlParams = new URLSearchParams(window.location.search);
  const cols = urlParams.get("cols");
  const width = 100 / cols;

  //Set .custom-column width based on the const width property
  const customColumns = document.querySelectorAll(".custom-column");
  customColumns.forEach((column) => {
    column.style.setProperty("--element-width", `${width}%`);
  });

  //Set default columns to 2
  const defaultColumns = 2;

  //if URL param is not set, set it to defaultColumns
  if (!urlParams.has("cols")) {
    window.location.search = `?cols=${defaultColumns}`;
  }

  //Update path and width based on user input
  const input = document.querySelector("columnSizeInput");
  const output = document.querySelector("#columnSizeOutput").value;

  //If value changes for the select box input, update the columns
  const selectBox = document.querySelector("#columnSelectBox");
  selectBox.addEventListener("change", (event) => {
    const value = event.target.value;
    window.location.search = `?cols=${value}`;
  });
</script>
